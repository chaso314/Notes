# 1.6 ICSF
## ICSFとは？
- **ICSF(Integrated Cryptographic Service Facility)** は、暗号化専用ハードウェアと暗号鍵を管理するソフトウェア。
  > 暗号化専用ハードウェア(Crypto Express card): ハードウェアレベレで暗号化・復号化機能を提供するカード。
- システムが暗号化専用ハードウェアの暗号化機能を利用できるようにするためAPIを提供する。

## 暗号方式と暗号鍵管理
### ICSFで利用可能な暗号方式
- **共通鍵暗号と公開鍵暗号**の両方が利用可能。
#### 共通鍵暗号
- 別名、対称鍵暗号(Symmetric cryptography)。秘密鍵暗号(Secret key cryptography)
- 暗号化と復号化に同じ鍵を用いる。
- 共通鍵暗号アルゴリズム
  - DES(Data Encryption Standard)、AES(Advanced Encryption Standard)、HMAC(Hash-based message authentication code)
#### 公開鍵暗号 (Public-key cryptography)
- 別名、非対称暗号(Asymmetric cryptography)、
- 2つの鍵のペア、公開鍵と秘密鍵を作成し、公開鍵を暗号化に、秘密鍵を復号化に用いる。
- 公開鍵暗号アルゴリズム
  - RSA(Rivest-Shamir-Adleman)、ECC(Elliptic Curve Cryptography)
### 鍵の管理
##### データセット
- ICSFは暗号鍵とトークンを3つのデータセットに分けて管理し、安全性を向上させる。
  - Cryptographic Key Data Set (CKDS): DES、AES、HMACの暗号鍵を格納
  - PKA Cryptographic Key Data Set (PKDS): RSA、ECCの鍵ペアを格納
  - Token Data Set (TKDS): PKCS#11のトークンとオブジェクトを格納
    > トークン: 秘密鍵や証明書の管理に用いられる。
##### マスター鍵
- ICSFはデータセットに暗号鍵を格納する際、**マスター鍵**で暗号化する。暗号鍵の種別に応じて4種のマスター鍵があり、安全性を向上させる。マスター鍵はCrypto Express card内のレジスタに保管される。
  - DES Master Key: DESの暗号鍵を暗号化する
  - AES Master Key: AESとHMACの暗号鍵を暗号化する
  - RSA Master Key: RSAの暗号鍵を暗号化する
  - ECC Master Key: ECCの暗号鍵を暗号化する
### 鍵の状態
- Zシステム上における鍵の状態は3種類。

  | 暗号鍵種別名 | 暗号鍵の状態 | 使用される場所 | DUMP上での記載 | 暗号化処理速度 |
  | --- | --- | --- | --- | :---: |
  | Clear Key | 暗号化されていない暗号鍵 | CPACF | 暗号化されていない | O |
  | Secure Key | マスター鍵で暗号化された暗号鍵 | Crypto Express card | 暗号化 | Δ |
  | Protected Key | 暗暗号鍵をCrypto Express cardで復号化した後、LPARのラッピング鍵で暗号化した鍵 | CPACF | 暗号化 | O |
  > CPACF(Central Processor Assist for Cryptographic Functions): 暗号化処理をハードウェアレベルで提供するプロセッサーの種類の1つ。ICSFとCrypto Express cardによる暗号化処理よりも高速。
  
  > Wrapping、Wrap: 安全でない領域に暗号鍵を渡す際、一時的に暗号鍵を暗号化すること。
>[!TIP]
>`ICSF`は暗号鍵を暗号化して管理し、暗号化専用ハードウェアへのアクセスをAPIで提供するソフトウェアです。ICSFが他システムに暗号鍵を渡す際、ラッピングして暗号化した鍵を渡すことで安全性を確保します。
------
# 1.7 z/OS security
- z/OSの機密情報へのアクセスや操作の制御の仕組みを述べる。
## 1.7.1 SAF
### SAFとは？
- **SAF(System Authorization Facility)** は、z/OSに内蔵されたセキュリティチェックのためのソフトウェア。他の全システムがリソースへのアクセスと認証を検証するために使用。
- SAFのセキュリティチェックはSAF単体で利用可能だが、**RACF**などの他のセキュリティマネージャシステムの併用してセキュリティを強化することが大半。この場合、実際のセキュリティ処理はRACFが担う。
  > サブシステムのセキュリティチェック利用手順
  > 1. サブシステムが`RACROUTEマクロ`を発行しセキュリティチェックを要求
  > 2. z/OSルータ(z/OS内のシステムコール転送機能(ルーティングソフトウェア))がセキュリティチェック要求をSAFに転送
  > 3. SAFがチェック結果をz/OSルータに返答
  > 4. z/OSルータが返答を確認。チェックOKならRACFに制御を渡す
>[!TIP]
>`SAF`はz/OS内のセキュリティチェック機能。z/OSはSAFを利用することで、外部のセキュリティマネージャによらずに一定のセキュリティチェック機能を提供できる。また、OSからセキュリティ処理を分離しOSの外に出すことができる。
## 1.7.2 RACF
### RACFとは?
- **RACF(Resource Access Control Facility)** はz/OSの標準的な外部セキュリティマネージャ。ユーザー、データセット、DASD、TSO、端末、アプリケーションへのアクセス(トランザクション)を制御する。
- 主要機能
  - ユーザー識別・認証: パスフレーズまたはパスワードで識別・認証
  - リソース保護: アクセスルール定義、不正アクセス防止
  - 監査・ロギング: 全セキュリティイベントを記録
