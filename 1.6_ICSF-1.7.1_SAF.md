# 1.6 ICSF
## ICSFとは？
- **ICSF(Integrated Cryptographic Service Facility)** は、暗号化専用ハードウェアと暗号鍵を管理するソフトウェア。
  > 暗号化専用ハードウェア(Crypto Express card): ハードウェアレベレで暗号化・復号化機能を提供するカード。
- システムが暗号化専用ハードウェアの暗号化機能を利用できるようにするためAPIを提供する。

## 暗号方式と暗号鍵管理
### ICSFで利用可能な暗号方式
- **共通鍵暗号と公開鍵暗号**の両方が利用可能。
#### 共通鍵暗号
- 別名、対称鍵暗号(Symmetric cryptography)。秘密鍵暗号(Secret key cryptography)
- 暗号化と復号化に同じ鍵を用いる。
- 共通鍵暗号アルゴリズム
  - DES(Data Encryption Standard)、AES(Advanced Encryption Standard)、HMAC(Hash-based message authentication code)
#### 公開鍵暗号 (Public-key cryptography)
- 別名、非対称暗号(Asymmetric cryptography)、
- 2つの鍵のペア、公開鍵と秘密鍵を作成し、公開鍵を暗号化に、秘密鍵を復号化に用いる。
- 公開鍵暗号アルゴリズム
  - RSA(Rivest-Shamir-Adleman)、ECC(Elliptic Curve Cryptography)
### 鍵の管理
##### データセット
- ICSFは暗号鍵とトークンを3つのデータセットに分けて管理し、安全性を向上させる。
  - Cryptographic Key Data Set (CKDS): DES、AES、HMACの暗号鍵を格納
  - PKA Cryptographic Key Data Set (PKDS): RSA、ECCの鍵ペアを格納
  - Token Data Set (TKDS): PKCS#11のトークンとオブジェクトを格納
    > トークン: 秘密鍵や証明書の管理に用いられる。
##### マスター鍵
- ICSFはデータセットに暗号鍵を格納する際、**マスター鍵**で暗号化する。暗号鍵の種別に応じて4種のマスター鍵があり、安全性を向上させる。マスター鍵はCrypto Express card内のレジスタに保管される。
  - DES Master Key: DESの暗号鍵を暗号化する
  - AES Master Key: AESとHMACの暗号鍵を暗号化する
  - RSA Master Key: RSAの暗号鍵を暗号化する
  - ECC Master Key: ECCの暗号鍵を暗号化する
### 鍵の状態
- Zシステム上における鍵の状態は3種類。

  | 種別名 | 暗号鍵の状態 | 使用される場所 | DUMP上での記載 | 暗号化速度 |
  | --- | --- | --- | --- | --- |
  | Clear Key | 暗号化されていない暗号鍵 | CPACF | 暗号化されていない | O |
  
  - Clear Key: 暗号化されていない暗号鍵。CPACFでの暗号化処理で使用。DUMP上にも暗号化されていない状態で書き出される。
  - Secure Key: マスター鍵で暗号化された暗号鍵。Crypto Express cardでの暗号化処理に使用。DUMPでも暗号化された状態。
  - Protected Key: 暗号鍵をCrypto Express cardで復号化した後、LPARのラッピング鍵で暗号化した鍵。CPACFでの暗号化処理で使用
>[!TIP]
>`ICSF`は暗号化専用ハードウェアへのアクセスをAPIで提供する
